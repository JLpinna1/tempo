<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Temporizadores ‚Ä¢ Cron√≥grafo ‚Ä¢ Reloj Mundial</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #f4f7fa;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #0ea5a4;
      --accent-600: #0b8f86;
      --danger: #ef4444;
      --glass: rgba(14,165,164,0.06);
      --shadow: 0 8px 30px rgba(2,6,23,0.06);
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    body{margin:0;background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
    .wrap{max-width:1100px;margin:28px auto;padding:18px;}
    header.page{display:flex;gap:12px;align-items:end;margin-bottom:18px;justify-content:space-between;}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}
    
    /* Auth styles */
    .auth-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .auth-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .login-btn {
      background: var(--accent);
      color: white;
      border: none;
    }
    .login-btn:hover {
      background: var(--accent-600);
    }
    .register-btn {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    .register-btn:hover {
      background: var(--glass);
    }
    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }
    .logout-btn {
      color: var(--muted);
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
    }
    
    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    .modal-overlay.active .modal {
      transform: translateY(0);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      color: #222222;
    }
    .modal-close {
      background: transparent;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #888888;
    }
    .form-group {
      margin-bottom: 18px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 600;
      color: #333333;
    }
    .form-input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #dddddd;
      font-size: 14px;
      background-color: #1e1e1e;
      color: #ffffff;
    }
    .form-input:focus {
      outline: none;
      border-color: #0ea5a4;
      box-shadow: 0 0 0 2px rgba(14,165,164,0.2);
    }
    .form-submit {
      width: 100%;
      padding: 14px;
      background: #0ea5a4;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .form-submit:hover {
      background: #0b8f86;
    }
    .form-footer {
      margin-top: 18px;
      text-align: center;
      font-size: 14px;
      color: #666666;
    }
    .form-footer a {
      color: #0ea5a4;
      text-decoration: none;
      cursor: pointer;
      font-weight: 600;
    }
    .form-footer a:hover {
      text-decoration: underline;
    }
    .error-message {
      color: #ef4444;
      font-size: 13px;
      margin-top: 4px;
      font-weight: 500;
    }

    /* Tabs */
    .tabs{display:flex;gap:8px;margin-top:8px}
    .tab-btn{background:transparent;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;color:var(--muted);font-weight:600}
    .tab-btn.active{background:var(--card);box-shadow:var(--shadow);color:var(--accent);}

    /* Layout */
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} .right-col{order:2} }

    /* Cards */
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
    .small-muted{color:var(--muted);font-size:13px}

    /* Timers list */
    .timers-list{display:flex;flex-direction:column;gap:12px}
    .timer-row{display:grid;grid-template-columns:110px 1fr 160px;gap:12px;align-items:center;padding:8px}
    @media (max-width:760px){ .timer-row{grid-template-columns:1fr} .timer-row > .right-actions{text-align:right} }

    .time-big{font-weight:700;font-size:20px}
    .time-meta{color:var(--muted);font-size:13px;margin-top:6px}

    .input-time, select, input[type=file]{padding:8px;border-radius:8px;border:1px solid #e6eef0;background:#fbfdfe;font-size:14px}

    .controls-inline{display:flex;gap:8px;align-items:center}
    .btn{padding:8px 12px;border-radius:999px;border:0;cursor:pointer;font-weight:700}
    .btn-start{background:var(--accent);color:white}
    .btn-pause{background:#eef7f6;color:var(--accent)}
    .btn-reset{background:#fff;border:1px solid #e6eef0}
    .btn-danger{background:var(--danger);color:white}

    .progress{height:10px;background:#eef7f6;border-radius:999px;overflow:hidden}
    .progress > .fill{height:100%;background:var(--accent);width:0%}

    .drag-handle{cursor:grab;opacity:.75;padding-right:6px;font-size:16px}

    /* Right column (world clock items) */
    .right-col .search-row{display:flex;gap:8px;align-items:center;margin-bottom:12px}
    .search-input{flex:1;padding:10px;border-radius:10px;border:1px solid #e6eef0;background:#fff}
    .suggestions{position:relative}
    .suggestions-list{position:absolute;left:0;right:0;background:#fff;border:1px solid #e6eef0;border-radius:10px;max-height:260px;overflow:auto;z-index:30;box-shadow:var(--shadow)}
    .suggestion{padding:10px;border-bottom:1px solid #f1f5f7;cursor:pointer}
    .suggestion:hover{background:#f8fdfc}

    .clocks-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:700px){ .clocks-grid{grid-template-columns:1fr} }

    .clock-card{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfeff);display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 6px 18px rgba(2,6,23,0.05)}
    .flag{font-size:20px}
    .city-name{font-weight:700}
    .clock-face{width:120px;height:120px;border-radius:999px;border:4px solid rgba(15,23,42,0.12);position:relative;display:flex;align-items:center;justify-content:center;background:#fff}
    .hand{position:absolute;left:50%;top:50%;transform-origin:0% 50%}
    .hand.hour{width:36%;height:4px;background:#111;border-radius:4px}
    .hand.min{width:48%;height:3px;background:#111;border-radius:4px}
    .hand.sec{width:48%;height:2px;background:#ef4444;border-radius:3px}

    .digital-time{font-size:18px;font-weight:700}

    footer.foot{margin-top:22px;text-align:center;color:var(--muted);font-size:13px}
    /* üé® Paleta base */
:root {
  --bg-color: #f9f9f9;
  --text-color: #222;
  --card-bg: #ffffff;
  --card-border: #ddd;
  --muted-text: #666;

  --button-primary: #009688;
  --button-primary-hover: #00796b;
  --button-danger: #e74c3c;
  --button-danger-hover: #c0392b;
  --button-secondary: #f1f1f1;
  --button-secondary-hover: #e0e0e0;
}

body.dark-mode {
  --bg-color: #181818;
  --text-color: #f1f1f1;
  --card-bg: #242424;
  --card-border: #333;
  --muted-text: #aaa;

  --button-primary: #26a69a;
  --button-primary-hover: #1f8e82;
  --button-danger: #ff6b6b;
  --button-danger-hover: #e05656;
  --button-secondary: #333;
  --button-secondary-hover: #444;
}
.btn-eliminar-top {
  position: absolute;
  top: 6px;
  right: 6px;
  border-radius: 50%;
  padding: 2px 6px;
  font-size: 14px;
  background: var(--danger);
  color: #fff;
  cursor: pointer;
}



/* üåç Fondo y texto */
body {
  background-color: var(--bg-color);
  color: var(--text-color);
  font-family: Arial, sans-serif;
  transition: background 0.3s, color 0.3s;
}

/* üì¶ Tarjetas y contenedores */
.card, .contenedor, .box, .panel {
  background-color: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 15px;
  margin: 10px 0;
  transition: background 0.3s, border 0.3s;
}

/* üîò Botones */
button {
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.2s;
}

button.comenzar {
  background-color: var(--button-primary);
  color: #fff;
}
button.comenzar:hover {
  background-color: var(--button-primary-hover);
}

button.eliminar {
  background-color: var(--button-danger);
  color: #fff;
}
button.eliminar:hover {
  background-color: var(--button-danger-hover);
}

button.reset {
  background-color: var(--button-secondary);
  color: var(--text-color);
}
button.reset:hover {
  background-color: var(--button-secondary-hover);
}

/* üìù Inputs y selects */
input, select {
  background-color: var(--card-bg);
  color: var(--text-color);
  border: 1px solid var(--card-border);
  border-radius: 6px;
  padding: 6px;
  transition: background 0.3s, color 0.3s, border 0.3s;
}

/* üìë Tabs */
.tabs button {
  background: none;
  border: none;
  padding: 10px 16px;
  font-weight: bold;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: border 0.2s, color 0.2s;
  color: var(--muted-text);
}

.tabs button.active {
  color: var(--text-color);
  border-bottom: 2px solid var(--button-primary);
}
/* ===========================
   VARIABLES DE TEMA
   =========================== */
body.light-mode {
  --bg: #f5f5f5;
  --text: #111;
  --card-bg: #fff;
  --card-text: #222;
  --input-bg: #fff;
  --input-text: #111;
  --tab-active-bg: #e0e0e0;
  --tab-active-text: #111;
}

body.dark-mode {
  --bg: #181818;
  --text: #f5f5f5;
  --card-bg: #2a2a2a;
  --card-text: #f5f5f5;
  --input-bg: #333;
  --input-text: #f5f5f5;
  --tab-active-bg: #444;
  --tab-active-text: #fff;
}

/* ===========================
   APLICACI√ìN DE VARIABLES
   =========================== */

/* Fondo general */
body {
  background-color: var(--bg);
  color: var(--text);
}

/* Tarjetas */
.clock-card {
  background-color: var(--card-bg) !important;
  color: var(--card-text) !important;
  border: 1px solid rgba(0,0,0,0.1);
}

/* Inputs */
input, select, textarea {
  background-color: var(--input-bg) !important;
  color: var(--input-text) !important;
  border: 1px solid #555;
  border-radius: 6px;
  padding: 4px 8px;
}

/* Tabs (arriba: Temporizadores, Cron√≥grafo, Reloj Mundial) */
.tab {
  background-color: transparent;
  color: var(--text);
}

.tab.active {
  background-color: var(--tab-active-bg) !important;
  color: var(--tab-active-text) !important;
}
/* ===========================
  THEME VARIABLES + OVERRIDES
  Pegar al final del CSS existente
   =========================== */

/* Variables por defecto (claro) */
:root{
  --bg: #f5f5f6;
  --text: #0f1722;
  --muted: #6b7280;
  --card-bg: #ffffff;
  --card-text: #111;
  --card-border: rgba(0,0,0,0.06);
  --input-bg: #ffffff;
  --input-text: #111;
  --tab-active-bg: #ffffff;
  --tab-active-text: #0ea5a4;
  --primary: #0ea5a4;
  --danger: #ef4444;
  --shadow: 0 10px 30px rgba(2,6,23,0.06);
}

/* Dark mode variables */
body.dark-mode {
  --bg: #151515;
  --text: #ececec;
  --muted: #a9a9a9;
  --card-bg: #1f1f1f;
  --card-text: #ececec;
  --card-border: rgba(255,255,255,0.04);
  --input-bg: #222;
  --input-text: #eee;
  --tab-active-bg: #222;
  --tab-active-text: #0ea5a4;
  --primary: #0ea5a4;
  --danger: #ff6b6b;
  --shadow: 0 8px 20px rgba(0,0,0,0.6);
}

/* Apply page background / text */
body {
  background: var(--bg) !important;
  color: var(--text) !important;
  transition: background .18s ease, color .18s ease;
}

/* Cards / containers */
.card, .clock-card, .timers-list, .right-col .card, .panel {
  background: var(--card-bg) !important;
  color: var(--card-text) !important;
  border: 1px solid var(--card-border) !important;
  box-shadow: var(--shadow) !important;
  transition: background .18s ease, color .18s ease, border .18s ease;
}

/* Make sure inner rounded boxes also adapt */
.timer-row.card, .timer-row, .timer-row .card {
  background: transparent !important; /* timer-row cards already inside parent card */
  color: inherit !important;
}

/* Tabs (top navigation) */
.tab-btn, .tabs button {
  background: transparent !important;
  color: var(--muted) !important;
  border: 1px solid transparent;
  transition: background .12s ease, color .12s ease, border .12s ease;
}
.tab-btn.active, .tabs button.active {
  background: var(--tab-active-bg) !important;
  color: var(--tab-active-text) !important;
  border-color: var(--card-border) !important;
  box-shadow: var(--shadow);
}

/* Inputs / selects / file inputs / time input */
input, textarea, select, input[type="time"], input[type="file"], .search-input {
  background: var(--input-bg) !important;
  color: var(--input-text) !important;
  border: 1px solid var(--card-border) !important;
  border-radius: 8px;
  padding: 6px 8px;
  transition: background .12s, color .12s, border-color .12s;
}

/* specific native time input color fixes for webkit */
input[type="time"]::-webkit-datetime-edit, 
input[type="time"]::-webkit-datetime-edit-text,
input[type="time"]::-webkit-datetime-edit-ampm-field {
  color: var(--input-text) !important;
  -webkit-text-fill-color: var(--input-text) !important;
}

/* Placeholder color */
input::placeholder, textarea::placeholder {
  color: rgba(var(--input-text, 255), 255, 255, 0.6);
}
/* fallback explicit placeholder for dark/light */
body.dark-mode input::placeholder { color: #bdbdbd !important; }
body:not(.dark-mode) input::placeholder { color: #888 !important; }

/* Buttons - make sure color contrasts */
.btn, button {
  color: var(--card-text) !important;
  background: transparent;
  border-radius: 999px;
  padding: 8px 12px;
  border: none;
}
.btn-start, .btn.btn-start, button.btn-start {
  background: var(--primary) !important;
  color: #fff !important;
}
.btn-danger, .btn.eliminar, button.btn-danger {
  background: var(--danger) !important;
  color: #fff !important;
}
.btn-reset, .btn.btn-reset {
  background: transparent !important;
  border: 1px solid var(--card-border) !important;
  color: var(--text) !important;
}

/* Progress bars */
.progress {
  background: rgba(255,255,255,0.03) !important;
  border-radius: 999px;
}
.progress > .fill { background: var(--primary) !important; }

/* Suggestions list dropdown */
.suggestions-list, .suggestions .suggestion {
  background: var(--card-bg) !important;
  color: var(--card-text) !important;
  border: 1px solid var(--card-border) !important;
}
.suggestion:hover { background: rgba(14,165,164,0.04) !important; }

/* CLOCK CARDS - force adapt to theme */
.clock-card {
  background: var(--card-bg) !important;
  color: var(--card-text) !important;
  border: 1px solid var(--card-border) !important;
  box-shadow: var(--shadow) !important;
}

/* digital time inside card */
.digital-time { color: var(--card-text) !important; font-weight:700; }

/* specific - ensure elements aren't translucent white overlays */
.clock-card .btn, .clock-card button {
  color: #fff !important;
}
.clock-card button.btn-reset { color: var(--card-text) !important; background: transparent !important; border: 1px solid var(--card-border) !important; }

/* ensure suggestions/placeholder cards not semi-transparent */
.suggestions-list .suggestion, .clocks-grid > .clock-card {
  opacity: 1 !important;
}

/* Higher specificity backup for stubborn inline/third-party rules */
body.dark-mode .clock-card,
body.dark-mode .clock-card * {
  background: var(--card-bg) !important;
  color: var(--card-text) !important;
  border-color: var(--card-border) !important;
}

/* Tabs/active look fix for strongly-styled white backgrounds */
body.dark-mode .tab-btn.active, body.dark-mode .tabs button.active {
  background: var(--tab-active-bg) !important;
  color: var(--tab-active-text) !important;
  box-shadow: none !important;
}

/* final fallback: if an element still shows pure white, make it use --card-bg */
div[style*="#fff"], input[style*="#fff"], .card[style*="#fff"] {
  background: var(--card-bg) !important;
  color: var(--card-text) !important;
}

/* smooth transitions */
* { transition: background .15s ease, color .12s ease, border-color .12s ease; }



  </style>
  
</head>
<body>
  <div class="wrap">
    <header class="page card">
      <div>
        <h1>Reloj & Temporizadores</h1>
        <div class="subtitle">Temporizadores m√∫ltiples, cron√≥grafo y reloj mundial con b√∫squeda y banderas.</div>
      </div>
      <div style="display: flex; align-items: center; gap: 15px; margin-left: auto;">
        <div class="small-muted">Guardado localmente en tu navegador</div>
        <div class="auth-buttons" id="auth-container">
          <button class="auth-btn login-btn" id="login-btn">Iniciar sesi√≥n</button>
          <button class="auth-btn register-btn" id="register-btn">Registrarse</button>
        </div>
        <div class="user-info" id="user-info" style="display: none;">
          <div class="user-avatar" id="user-avatar">U</div>
          <span id="username-display"></span>
          <button class="logout-btn" id="logout-btn">Cerrar sesi√≥n</button>
        </div>
      </div>
    </header>

</div>
    
    <!-- Modal de inicio de sesi√≥n -->
    <div class="modal-overlay" id="login-modal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Iniciar sesi√≥n</h3>
          <button class="modal-close" id="close-login-modal">&times;</button>
        </div>
        <form id="login-form">
          <div class="form-group">
            <label class="form-label" for="login-email">Correo electr√≥nico</label>
            <input type="email" id="login-email" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="login-password">Contrase√±a</label>
            <input type="password" id="login-password" class="form-input" required>
          </div>
          <div id="login-error" class="error-message" style="display: none;"></div>
          <button type="submit" class="form-submit">Iniciar sesi√≥n</button>
          <div class="form-footer">
            ¬øNo tienes una cuenta? <a id="switch-to-register">Reg√≠strate</a>
          </div>
        </form>
      </div>
    </div>
    
    <!-- Modal de registro -->
    <div class="modal-overlay" id="register-modal">
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Crear cuenta</h3>
          <button class="modal-close" id="close-register-modal">&times;</button>
        </div>
        <form id="register-form">
          <div class="form-group">
            <label class="form-label" for="register-name">Nombre</label>
            <input type="text" id="register-name" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="register-email">Correo electr√≥nico</label>
            <input type="email" id="register-email" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="register-password">Contrase√±a</label>
            <input type="password" id="register-password" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="register-confirm-password">Confirmar contrase√±a</label>
            <input type="password" id="register-confirm-password" class="form-input" required>
          </div>
          <div id="register-error" class="error-message" style="display: none;"></div>
          <button type="submit" class="form-submit">Registrarse</button>
          <div class="form-footer">
            ¬øYa tienes una cuenta? <a id="switch-to-login">Inicia sesi√≥n</a>
          </div>
        </form>
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Secciones">
      <button class="tab-btn active" id="tabTimersBtn" data-tab="timers">Temporizadores</button>
      <button class="tab-btn" id="tabStopwatchBtn" data-tab="stopwatch">Cron√≥grafo</button>
      <button class="tab-btn" id="tabWorldBtn" data-tab="world">Reloj Mundial</button>
    </div>

    <div class="grid">
      <!-- Left column -->
      <div>
        <!-- Timers content -->
        <div id="timersTab" class="card section">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
            <div>
              <strong>Temporizadores</strong>
              <div class="small-muted">A√±ad√≠ temporizadores, personaliz√° el nombre, la duraci√≥n y el sonido.</div>
            </div>
            <div class="small-muted">Total: <span id="totalTime">00:00:00</span></div>
          </div>

          <div class="timers-list card" id="timersList" aria-live="polite"></div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
            <button class="btn btn-reset" id="addTimerBtn">+ Agregar temporizador</button>
            <div class="small-muted">Arrastr√° ‚ò∞ para reordenar</div>
          </div>
        </div>

        <!-- Stopwatch content -->
        <div id="stopwatchTab" class="card section" style="display:none">
          <div style="text-align:center">
            <div style="font-size:44px;font-weight:700" id="swTime">00:00:00.0</div>
            <div style="margin-top:10px;display:flex;gap:10px;justify-content:center">
              <button class="btn btn-start" id="swStart">Comenzar</button>
              <button class="btn btn-pause" id="swLap">Dividir</button>
              <button class="btn btn-reset" id="swReset">Reiniciar</button>
            </div>
            <div style="margin-top:12px"><strong>Vueltas</strong><ol id="swLaps"></ol></div>
          </div>
        </div>

        <!-- World clocks (main area on mobile) -->
        <div id="worldTabMobile" class="card section" style="display:none">
          <strong>Reloj Mundial</strong>
          <div class="small-muted">Us√° la pesta√±a derecha para buscar y agregar ciudades.</div>
        </div>
      </div>

      <!-- Right column -->
      <aside class="right-col">
        <div class="card">
          <strong>Reloj Mundial</strong>
          <div class="small-muted">Busc√° ciudades (autocompletado) y agregalas como relojes.</div>

          <div class="search-row" style="margin-top:12px">
            <div style="flex:1;position:relative">
              <input id="citySearch" class="search-input" placeholder="Buscar ciudad, ej. Buenos Aires..." autocomplete="off" />
              <div class="suggestions" id="suggestionsWrap" style="display:none">
                <div class="suggestions-list" id="suggestionsList"></div>
              </div>
            </div>
            <button class="btn btn-start" id="addSelectedBtn">Agregar</button>
          </div>

          <div style="margin-top:10px" class="small-muted">Sugerencias: ciudad ‚Äî pa√≠s (UTC ¬± offset)</div>

          <div style="margin-top:12px" class="clocks-grid" id="clocksGrid"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Opciones</strong>
          <div style="margin-top:10px" class="small-muted">
            Si quer√©s autocompletado completo (todas las zonas) peg√° tu API key de TimezoneDB abajo y recarg√° la p√°gina.
          </div>
          <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
            <input id="tzApiKey" placeholder="TimezoneDB API key (opcional)" style="padding:8px;border-radius:8px;border:1px solid #e6eef0" />
            <button class="btn btn-reset" id="saveApiKeyBtn">Guardar API key</button>
            <div class="small-muted" style="font-size:12px">Si us√°s API, la app intentar√° descargar la lista completa de zonas. Si falla, se usa la lista local.</div>
          </div>
        </div>
      </aside>
    </div>

    <footer class="foot">-------------versi√≥n 1.0.8-------------</footer>
  </div>

  <script>
    // C√≥digo de autenticaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      // Referencias a elementos DOM
      const loginBtn = document.getElementById('login-btn');
      const registerBtn = document.getElementById('register-btn');
      const loginModal = document.getElementById('login-modal');
      const registerModal = document.getElementById('register-modal');
      const closeLoginModal = document.getElementById('close-login-modal');
      const closeRegisterModal = document.getElementById('close-register-modal');
      const switchToRegister = document.getElementById('switch-to-register');
      const switchToLogin = document.getElementById('switch-to-login');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const authContainer = document.getElementById('auth-container');
      const userInfo = document.getElementById('user-info');
      const userAvatar = document.getElementById('user-avatar');
      const usernameDisplay = document.getElementById('username-display');
      const logoutBtn = document.getElementById('logout-btn');
      const loginError = document.getElementById('login-error');
      const registerError = document.getElementById('register-error');

      // Comprobar si hay un usuario en localStorage al cargar la p√°gina
      checkAuthStatus();

      // Event listeners para abrir/cerrar modales
      loginBtn.addEventListener('click', () => {
        loginModal.classList.add('active');
      });

      registerBtn.addEventListener('click', () => {
        registerModal.classList.add('active');
      });

      closeLoginModal.addEventListener('click', () => {
        loginModal.classList.remove('active');
      });

      closeRegisterModal.addEventListener('click', () => {
        registerModal.classList.remove('active');
      });

      // Cambiar entre modales
      switchToRegister.addEventListener('click', () => {
        loginModal.classList.remove('active');
        registerModal.classList.add('active');
      });

      switchToLogin.addEventListener('click', () => {
        registerModal.classList.remove('active');
        loginModal.classList.add('active');
      });

      // Cerrar modales al hacer clic fuera
      window.addEventListener('click', (e) => {
        if (e.target === loginModal) {
          loginModal.classList.remove('active');
        }
        if (e.target === registerModal) {
          registerModal.classList.remove('active');
        }
      });

      // Manejar env√≠o del formulario de inicio de sesi√≥n
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        // Obtener usuarios del localStorage
        const users = JSON.parse(localStorage.getItem('users')) || [];
        
        // Buscar usuario
        const user = users.find(u => u.email === email && u.password === password);
        
        if (user) {
          // Guardar sesi√≥n
          localStorage.setItem('currentUser', JSON.stringify(user));
          
          // Actualizar UI
          updateUIForLoggedInUser(user);
          
          // Cerrar modal
          loginModal.classList.remove('active');
          
          // Limpiar formulario
          loginForm.reset();
        } else {
          // Mostrar error
          loginError.textContent = 'Correo electr√≥nico o contrase√±a incorrectos';
          loginError.style.display = 'block';
        }
      });

      // Manejar env√≠o del formulario de registro
      registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('register-name').value;
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;
        const confirmPassword = document.getElementById('register-confirm-password').value;
        
        // Validar contrase√±as
        if (password !== confirmPassword) {
          registerError.textContent = 'Las contrase√±as no coinciden';
          registerError.style.display = 'block';
          return;
        }
        
        // Obtener usuarios existentes
        const users = JSON.parse(localStorage.getItem('users')) || [];
        
        // Verificar si el correo ya est√° registrado
        if (users.some(u => u.email === email)) {
          registerError.textContent = 'Este correo electr√≥nico ya est√° registrado';
          registerError.style.display = 'block';
          return;
        }
        
        // Crear nuevo usuario
        const newUser = {
          id: Date.now().toString(),
          name,
          email,
          password,
          createdAt: new Date().toISOString()
        };
        
        // Guardar usuario
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        
        // Iniciar sesi√≥n autom√°ticamente
        localStorage.setItem('currentUser', JSON.stringify(newUser));
        
        // Actualizar UI
        updateUIForLoggedInUser(newUser);
        
        // Cerrar modal
        registerModal.classList.remove('active');
        
        // Limpiar formulario
        registerForm.reset();
      });

      // Manejar cierre de sesi√≥n
      logoutBtn.addEventListener('click', () => {
        // Eliminar sesi√≥n
        localStorage.removeItem('currentUser');
        
        // Actualizar UI
        authContainer.style.display = 'flex';
        userInfo.style.display = 'none';
      });

      // Funci√≥n para comprobar estado de autenticaci√≥n
      function checkAuthStatus() {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        
        if (currentUser) {
          updateUIForLoggedInUser(currentUser);
        }
      }

      // Funci√≥n para actualizar UI cuando hay un usuario logueado
      function updateUIForLoggedInUser(user) {
        // Ocultar botones de login/registro
        authContainer.style.display = 'none';
        
        // Mostrar info de usuario
        userInfo.style.display = 'flex';
        
        // Actualizar avatar con inicial
        userAvatar.textContent = user.name.charAt(0).toUpperCase();
        
        // Mostrar nombre de usuario
        usernameDisplay.textContent = user.name;
      }
    });
  </script>
  <script>
  /* ===========================
     CONFIG
     =========================== */
  /* --- CONFIG: TIMEZONEDB API KEY ---
     Si ten√©s una API key de TimezoneDB, pegala aqu√≠ o en el input de "Opciones".
     Ejemplo: 'ABCD1234...'
  */
  let TIMEZONEDB_API_KEY = ''; // si la dej√°s vac√≠a, usamos lista local

  /* ===========================
     UTILITIES
     =========================== */
  const STORAGE_KEY = 'app_timers_world_v1';
  function uid(){ return Math.random().toString(36).slice(2,9) }
  function pad(n){ return String(n).padStart(2,'0'); }
  function secondsToHMS(sec){
    sec = Math.max(0, Math.floor(sec));
    const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
    return `${pad(h)}:${pad(m)}:${pad(s)}`;
  }
  function msToInputTime(ms){
    const sec = Math.max(0, Math.floor(ms/1000));
    return secondsToHMS(sec);
  }
  function timeInputToSeconds(str){
    if(!str) return 0;
    const parts = str.split(':').map(x=>parseInt(x,10)||0);
    if(parts.length===3) return parts[0]*3600 + parts[1]*60 + parts[2];
    if(parts.length===2) return parts[0]*60 + parts[1];
    return parts[0]||0;
  }
  function countryCodeToFlagEmoji(cc){
    if(!cc) return '';
    // cc must be 2 letters
    const code = cc.toUpperCase();
    if(code.length !== 2) return '';
    const OFFSET = 0x1F1E6 - 65;
    const chars = [...code].map(c=> String.fromCodePoint(c.charCodeAt(0) + OFFSET)).join('');
    return chars;
  }

  /* ===========================
     STATE (localStorage)
     =========================== */
  let state = {
    timers: [], // {id,name,durationSec,remainingSec,active,sound:{type:'preset'|'custom',id|data}}
    stopwatch: {elapsedMs:0, running:false, laps:[]},
    world: {clocks: []}, // clocks: [{tz, name, countryCode, analog:true}]
    tzListFetched: false
  };

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) state = JSON.parse(raw);
    }catch(e){ console.warn('load state err', e) }
    // defaults
    if(!state.timers || !Array.isArray(state.timers)) state.timers = [];
    if(!state.world) state.world = {clocks:[]};
    if(!state.stopwatch) state.stopwatch = {elapsedMs:0, running:false, laps:[]};
  }
  function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

/* ==============================
   SOUND PRESETS ACTUALIZADOS
   ============================== */

const PRESETS = {
  alarmclock1: { label: 'Alarm Clock 1', src: 'sounds-1/alarm-clock-1-m.mp3' },
  aldeano: { label: 'Aldeano (AOE2)', src: 'sounds-1/aldeano-spawn-age-of-empires-2.mp3' },
  aoe2stable: { label: 'AOE2 Stable', src: 'sounds-1/aoe2-stable.mp3' },
  boathorn: { label: 'Boat Horn', src: 'sounds-1/boat-horn.mp3' },
  boxingbell: { label: 'Boxing Bell', src: 'sounds-1/boxing-bell.mp3' },
  bugle: { label: 'Bugle Cavalry Charge', src: 'sounds-1/bugle-call-cavalry-charge.mp3' },
  ding: { label: 'Ding', src: 'sounds-1/ding-sound-effect_2.mp3' },
  duolingo: { label: 'Duolingo Lesson Complete', src: 'sounds-1/duolingo-completed-lesson.mp3' },
  goodmorn: { label: 'Good Morning', src: 'sounds-1/goodmorn1.mp3' },
  haloreach: { label: 'Halo Reach Flag Captured', src: 'sounds-1/halo-reach-flag-captured.mp3' },
  harps: { label: 'Harps', src: 'sounds-1/harps.mp3' },
  horse: { label: 'Horse Whinny', src: 'sounds-1/horse-whinny.mp3' },
  iworocc: { label: 'Iworocc', src: 'sounds-1/iworocc.mp3' },
  japan: { label: 'Japan Theme', src: 'sounds-1/japan-theme.mp3' },
  pulsepoint: { label: 'Pulsepoint Notification', src: 'sounds-1/pulsepoint-notification-sound.mp3' },
  reservealarm: { label: 'Reserve Alarm', src: 'sounds-1/reserve-alarm-type-beat-mp3cut.mp3' },
  shelly: { label: 'Shelly Overworld Day', src: 'sounds-1/scott-lloyd-shelly-overworld-day.mp3' },
  shogun: { label: 'Shogun Shameful Display', src: 'sounds-1/shogun-total-war-shameful-display.mp3' },
  shotsfired: { label: 'Shots Fired', src: 'sounds-1/shots-fired_2.mp3' },
  skipper: { label: 'Skipper Cebo', src: 'sounds-1/skipper-cebo.mp3' },
  success: { label: 'Success Chime', src: 'sounds-1/success-chime.mp3' },
  tmp: { label: 'Tmp', src: 'sounds-1/tmp4en9dcrj.mp3' },
  upgrade: { label: 'Upgrade Complete', src: 'sounds-1/upgrade_complete.mp3' },
  windchime: { label: 'Wind Chime', src: 'sounds-1/wind-chime-1.mp3' }
};




  function playBeep(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.frequency.value = 880;
      o.connect(g); g.connect(ctx.destination);
      o.start();
      g.gain.setValueAtTime(0.5, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1);
      o.stop(ctx.currentTime + 1);
    }catch(e){ console.warn('Audio err', e) }
  }

  function playSound(sound){
    if(!sound) { playBeep(); return; }
    if(sound.type === 'preset'){
      const p = PRESETS[sound.id];
      if(!p) { playBeep(); return; }
      if(p.src){ new Audio(p.src).play().catch(()=>{}); }
      else playBeep();
    } else if(sound.type === 'custom'){
      try{ new Audio(sound.data).play().catch(()=>{}); } catch(e){ console.warn(e); playBeep(); }
    }
  }

  /* ===========================
     TIMERS: UI + Logic
     =========================== */
  const timersListEl = document.getElementById('timersList');
  const totalTimeEl = document.getElementById('totalTime');
  function createTimerObject(name='Temporizador', durationSec=120){
    return { id: uid(), name, durationSec, remainingSec: durationSec, active:false,
      sound: { type:'preset', id:'beep'} };
  }

  function addTimer(name, durationSec){
    state.timers.push(createTimerObject(name, durationSec));
    saveState(); renderTimers();
  }

  function renderTimers(){
    timersListEl.innerHTML = '';
    state.timers.forEach((t, index) => {
const row = document.createElement('div');
row.className = 'timer-row card';
row.draggable = true;
row.dataset.id = t.id;

// üëá Aseguramos que sea relativo
row.style.position = 'relative';

      const left = document.createElement('div');
      left.innerHTML = `<div class="drag-handle">‚ò∞</div><div class="time-big" id="time-${t.id}">${secondsToHMS(Math.ceil(t.remainingSec))}</div>
                        <div class="time-meta" id="meta-${t.id}">${t.active? 'En curso': '('+secondsToHMS(t.durationSec)+')'}</div>`;

      const center = document.createElement('div');
      center.className = 'center-col';
      const nameEl = document.createElement('div');
      nameEl.textContent = t.name;
      nameEl.contentEditable = true;
      nameEl.className = 'timer-name';
      nameEl.style.fontWeight = 600;
      nameEl.addEventListener('input', ()=> { t.name = nameEl.innerText; saveState(); });

      const row2 = document.createElement('div');
      row2.className = 'controls-inline';
      const inputTime = document.createElement('input');
      inputTime.className = 'input-time';
      inputTime.type = 'time';
      inputTime.step = 1;
      inputTime.value = secondsToHMS(t.durationSec);
      inputTime.addEventListener('change', ()=>{
        const secs = timeInputToSeconds(inputTime.value);
        t.durationSec = secs; t.remainingSec = secs; saveState(); renderTimers();
      });

      // sound select
      const sel = document.createElement('select');
      sel.style.padding='8px';
      for(const id in PRESETS){ const o = document.createElement('option'); o.value = id; o.textContent = PRESETS[id].label; if(t.sound && t.sound.type==='preset' && t.sound.id===id) o.selected=true; sel.appendChild(o); }
      const oCustom = document.createElement('option'); oCustom.value='__custom'; oCustom.textContent='Personalizado'; if(t.sound && t.sound.type==='custom') oCustom.selected=true; sel.appendChild(oCustom);
      sel.addEventListener('change', ()=> {
        if(sel.value === '__custom') {
          t.sound = {type:'custom', data: t.sound && t.sound.type==='custom' ? t.sound.data : null};
        } else {
          t.sound = {type:'preset', id: sel.value};
        }
        saveState();
      });

      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'audio/*';
      fileInput.style.maxWidth = '180px';
      fileInput.addEventListener('change', (ev)=> {
        const f = ev.target.files[0];
        if(!f) return;
        const r = new FileReader();
        r.onload = ()=> {
          t.sound = {type:'custom', data: r.result};
          saveState();
          renderTimers();
        };
        r.readAsDataURL(f);
      });

      row2.appendChild(inputTime); row2.appendChild(sel); row2.appendChild(fileInput);
      center.appendChild(nameEl); center.appendChild(row2);
      const progress = document.createElement('div'); progress.className = 'progress'; progress.style.marginTop='8px';
      const fill = document.createElement('div'); fill.className='fill'; fill.style.width = progressPercent(t) + '%';
      progress.appendChild(fill); center.appendChild(progress);

      const right = document.createElement('div'); right.className='right-actions';
      const startBtn = document.createElement('button'); startBtn.className='btn';
      startBtn.classList.add(t.active? 'btn-pause' : 'btn-start'); startBtn.textContent = t.active? 'Pausar' : 'Comenzar';
      startBtn.addEventListener('click', ()=> {
      if(t.active){ 
      stopAlarmLoop(); // üîá detener si estaba sonando
      }
      t.active = !t.active;
      if(t.active) ensureTimersTicker();
      saveState(); renderTimers();
      });

      const resetBtn = document.createElement('button'); resetBtn.className='btn btn-reset'; resetBtn.textContent='Reset';
      resetBtn.addEventListener('click', ()=> { 
      t.remainingSec = t.durationSec; 
      t.active=false; 
      stopAlarmLoop(); // üîá detener sonido
      saveState(); renderTimers(); 
      });
      // eliminar bot√≥n

// bot√≥n X arriba a la derecha (por temporizador)
const delBtn = document.createElement('button');
delBtn.className = 'btn-eliminar-top';
delBtn.textContent = '‚úï';
delBtn.addEventListener('click', ()=> { 
  state.timers = state.timers.filter(x=>x.id!==t.id); 
  saveState(); 
  renderTimers(); 
});
row.appendChild(delBtn);

      right.appendChild(startBtn); right.appendChild(resetBtn); right.appendChild(delBtn);

      row.appendChild(left); row.appendChild(center); row.appendChild(right);
      timersListEl.appendChild(row);

      // drag handlers
      row.addEventListener('dragstart', (e)=> { e.dataTransfer.setData('text/id', t.id); row.style.opacity = 0.6; });
      row.addEventListener('dragend', ()=> row.style.opacity = 1);
      row.addEventListener('dragover', (e)=> e.preventDefault());
      row.addEventListener('drop', (e)=> {
        e.preventDefault();
        const otherId = e.dataTransfer.getData('text/id');
        if(!otherId || otherId === t.id) return;
        reorderTimers(otherId, t.id);
        saveState(); renderTimers();
      });
    });

    renderTotal();
  }

  function progressPercent(t){
    if(!t.durationSec) return 0;
    const used = t.durationSec - t.remainingSec;
    return Math.max(0, Math.min(100, (used / t.durationSec) * 100));
  }

  function renderTotal(){
    const totalSec = state.timers.reduce((s,t)=> s + Math.ceil(t.remainingSec), 0);
    totalTimeEl.textContent = secondsToHMS(totalSec);
  }

  function reorderTimers(sourceId, targetId){
    const si = state.timers.findIndex(x=>x.id===sourceId);
    const ti = state.timers.findIndex(x=>x.id===targetId);
    if(si<0 || ti<0) return;
    const [item] = state.timers.splice(si,1); state.timers.splice(ti,0,item);
  }

  let timersTicker = null;
  function ensureTimersTicker(){
    if(timersTicker) return;
    timersTicker = setInterval(()=> {
      state.timers.forEach(t => {
        if(t.active){
          t.remainingSec = Math.max(0, t.remainingSec - 1);
         if(t.remainingSec <= 0){
           t.active = false;
           startAlarmLoop(t.sound); // üîî empieza a sonar en bucle
          }

        }
      });
      saveState();
      // update visible timers quickly
      state.timers.forEach(t => {
        const timeEl = document.getElementById('time-'+t.id);
        if(timeEl) timeEl.textContent = secondsToHMS(Math.ceil(t.remainingSec));
        const metaEl = document.getElementById('meta-'+t.id);
        if(metaEl) metaEl.textContent = t.active? 'En curso' : '('+secondsToHMS(t.durationSec)+')';
        const bar = document.getElementById('bar-'+t.id);
        if(bar) bar.style.width = progressPercent(t) + '%';
      });
      renderTotal();
    }, 1000);
  }

  /* ===========================
     STOPWATCH
     =========================== */
  const swTimeEl = document.getElementById('swTime');
  const swLapsEl = document.getElementById('swLaps');
  let swInterval = null;
  function swRender(){
    const ms = state.stopwatch.elapsedMs;
    const h = Math.floor(ms / 3600000);
    const m = Math.floor(ms / 60000) % 60;
    const s = Math.floor(ms / 1000) % 60;
    const d = Math.floor((ms % 1000) / 100);
    swTimeEl.textContent = `${pad(h)}:${pad(m)}:${pad(s)}.${d}`;
  }
  document.getElementById('swStart').addEventListener('click', ()=>{
    if(state.stopwatch.running){
      // pause
      state.stopwatch.running = false;
      clearInterval(swInterval); swInterval = null;
    } else {
      // start/resume
      state.stopwatch.running = true;
      const start = Date.now() - state.stopwatch.elapsedMs;
      swInterval = setInterval(()=> {
        state.stopwatch.elapsedMs = Date.now() - start;
        swRender();
      }, 100);
    }
    saveState();
    document.getElementById('swStart').textContent = state.stopwatch.running? 'Pausar' : 'Comenzar';
  });
  document.getElementById('swLap').addEventListener('click', ()=>{
    state.stopwatch.laps.push(state.stopwatch.elapsedMs);
    saveState(); renderLaps();
  });
  document.getElementById('swReset').addEventListener('click', ()=>{
    state.stopwatch.running = false; state.stopwatch.elapsedMs = 0; state.stopwatch.laps = [];
    clearInterval(swInterval); swInterval = null; swRender(); renderLaps(); saveState(); document.getElementById('swStart').textContent = 'Comenzar';
  });
  function renderLaps(){
    swLapsEl.innerHTML = '';
    state.stopwatch.laps.forEach((l, i) => {
      const li = document.createElement('li'); li.textContent = `${i+1}. ${formatMs(l)}`; swLapsEl.appendChild(li);
    });
  }
  function formatMs(ms){
    const h = Math.floor(ms / 3600000);
    const m = Math.floor(ms / 60000) % 60;
    const s = Math.floor(ms / 1000) % 60;
    const d = Math.floor((ms % 1000) / 100);
    return `${pad(h)}:${pad(m)}:${pad(s)}.${d}`;
  }

  /* ===========================
     WORLD CLOCKS
     =========================== */
  // fallback list (popular cities). If TIMEZONEDB_API_KEY is provided, the app will try to fetch full list automatically.
  const fallbackZones = [
    {tz:'America/Argentina/Buenos_Aires', name:'Buenos Aires', cc:'AR'},
    {tz:'America/New_York', name:'Nueva York', cc:'US'},
    {tz:'Europe/London', name:'Londres', cc:'GB'},
    {tz:'Europe/Madrid', name:'Madrid', cc:'ES'},
    {tz:'Europe/Paris', name:'Par√≠s', cc:'FR'},
    {tz:'Asia/Tokyo', name:'Tokio', cc:'JP'},
    {tz:'Australia/Sydney', name:'S√≠dney', cc:'AU'},
    {tz:'America/Mexico_City', name:'Ciudad de M√©xico', cc:'MX'},
    {tz:'America/Sao_Paulo', name:'S√£o Paulo', cc:'BR'},
    {tz:'Europe/Berlin', name:'Berl√≠n', cc:'DE'},
    {tz:'Europe/Moscow', name:'Mosc√∫', cc:'RU'},
    {tz:'Asia/Shanghai', name:'Beijing', cc:'CN'},
    {tz:'Asia/Hong_Kong', name:'Hong Kong', cc:'HK'},
    {tz:'Asia/Singapore', name:'Singapur', cc:'SG'},
    {tz:'Asia/Seoul', name:'Se√∫l', cc:'KR'},
    {tz:'America/Los_Angeles', name:'Los √Ångeles', cc:'US'},
    {tz:'America/Chicago', name:'Chicago', cc:'US'},
    {tz:'America/Toronto', name:'Toronto', cc:'CA'},
    {tz:'Africa/Cairo', name:'El Cairo', cc:'EG'},
    {tz:'Africa/Johannesburg', name:'Johannesburgo', cc:'ZA'},
    {tz:'Asia/Kolkata', name:'Delhi', cc:'IN'},
    {tz:'Asia/Dubai', name:'Dub√°i', cc:'AE'},
    {tz:'Europe/Istanbul', name:'Estambul', cc:'TR'}
  ];

  // will hold zones for autocompletion
  let zones = [...fallbackZones]; // objects {tz, name, cc}

  const searchInput = document.getElementById('citySearch');
  const suggestionsWrap = document.getElementById('suggestionsWrap');
  const suggestionsList = document.getElementById('suggestionsList');
  const addSelectedBtn = document.getElementById('addSelectedBtn');
  const clocksGrid = document.getElementById('clocksGrid');

  // try to fetch full list from TimezoneDB if key provided
  async function fetchZonesFromAPI(){
    if(!TIMEZONEDB_API_KEY) return;
    try{
      const url = `https://api.timezonedb.com/v2.1/list-time-zone?key=${encodeURIComponent(TIMEZONEDB_API_KEY)}&format=json`;
      const res = await fetch(url);
      if(!res.ok) throw new Error('fetch failed');
      const data = await res.json();
      if(Array.isArray(data.zones) && data.zones.length > 0){
        // map to our format
        zones = data.zones.map(z => {
          return { tz: z.zoneName, name: z.zoneName.split('/').pop().replace('_',' '), cc: z.countryCode || '' };
        });
        state.tzListFetched = true; saveState();
      }
    }catch(e){
      console.warn('Could not fetch TimezoneDB zones, using fallback list.', e);
      // keep fallback
    }
  }

  // utility: compute UTC offset (hours) for a timezone
  function getUTCOffsetForTZ(tz){
    try{
      const now = new Date();
      const tzDate = new Date(new Date().toLocaleString('en-US', { timeZone: tz }));
      const utcDate = new Date(new Date().toLocaleString('en-US', { timeZone: 'UTC' }));
      const offset = (tzDate.getTime() - utcDate.getTime()) / (3600*1000);
      // round to nearest 0.25 (some zones have 30/45 min)
      return Math.round(offset*100)/100;
    }catch(e){ return 0; }
  }

  // suggestions logic
  let selectedSuggestion = null;
  searchInput.addEventListener('input', (e)=> {
    const q = e.target.value.trim().toLowerCase();
    if(!q){ suggestionsWrap.style.display='none'; selectedSuggestion=null; return; }
    const results = zones.filter(z => {
      return (z.name && z.name.toLowerCase().includes(q)) || (z.tz && z.tz.toLowerCase().includes(q));
    }).slice(0,12);
    suggestionsList.innerHTML = '';
    results.forEach(r => {
      const off = getUTCOffsetForTZ(r.tz);
      const offStr = (off>=0? '+'+off : String(off));
      const country = r.cc || '';
      const flag = countryCodeToFlagEmoji(country);
      const line = document.createElement('div');
      line.className = 'suggestion';
      line.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${r.name}</strong> <span style="color:var(--muted)">‚Äî ${country? r.cc: ''}</span></div><div style="font-size:13px;color:var(--muted)">${flag} UTC${offStr}</div></div><div style="color:var(--muted);font-size:13px;margin-top:6px">${r.tz}</div>`;
      line.addEventListener('click', ()=> {
        selectedSuggestion = r;
        searchInput.value = `${r.name} ‚Äî ${r.cc || ''} (UTC${off>=0? '+'+off:off})`;
        suggestionsWrap.style.display='none';
      });
      suggestionsList.appendChild(line);
    });
    suggestionsWrap.style.display = results.length ? 'block' : 'none';
  });

  // hide suggestions on outside click
  document.addEventListener('click', (e)=>{
    if(!document.getElementById('suggestionsWrap').contains(e.target) && e.target !== searchInput){
      suggestionsWrap.style.display = 'none';
    }
  });

  // add selected suggestion
  addSelectedBtn.addEventListener('click', ()=> {
    if(!selectedSuggestion){
      // try to match input text to zone
      const q = searchInput.value.trim().toLowerCase();
      const found = zones.find(z => (z.name && z.name.toLowerCase() === q) || (z.tz && z.tz.toLowerCase() === q));
      if(found) selectedSuggestion = found;
    }
    if(!selectedSuggestion) { alert('Seleccion√° una ciudad de la lista o escrib√≠ el nombre y elegila.'); return; }
    state.world.clocks.push({ tz: selectedSuggestion.tz, name: selectedSuggestion.name, countryCode: selectedSuggestion.cc || '', analog: true });
    selectedSuggestion = null; searchInput.value = ''; saveState(); renderClocks();
  });

  // render clocks
  function renderClocks(){
    clocksGrid.innerHTML = '';
    state.world.clocks.forEach((c,i) => {
      const card = document.createElement('div'); card.className = 'clock-card';
      const flag = countryCodeToFlagEmoji(c.countryCode);
      card.innerHTML = `<div class="flag">${flag}</div>
                        <div class="city-name">${c.name}</div>
                        <div class="clock-face" id="face-${i}">
                          <div class="hand hour" id="hour-${i}"></div>
                          <div class="hand min" id="min-${i}"></div>
                          <div class="hand sec" id="sec-${i}"></div>
                        </div>
                        <div class="digital-time" id="digital-${i}">--:--:--</div>
                        <div style="display:flex;gap:8px;margin-top:8px">
                          <button class="btn btn-reset" id="toggle-${i}">${c.analog? 'Digital' : 'Anal√≥gico'}</button>
                          <button class="btn btn-danger" id="del-${i}">Eliminar</button>
                        </div>`;
      clocksGrid.appendChild(card);

      // event listeners
      document.getElementById(`toggle-${i}`).addEventListener('click', ()=>{
        c.analog = !c.analog;
        saveState();
        renderClocks();
      });
      document.getElementById(`del-${i}`).addEventListener('click', ()=>{
        state.world.clocks.splice(i,1); saveState(); renderClocks();
      });
    });
  }

  // update clock hands every second
  function updateClocks(){
    state.world.clocks.forEach((c,i) => {
      // digital
      try{
        const nowStr = new Date().toLocaleString('en-US', { timeZone: c.tz });
        const now = new Date(nowStr);
        const h = now.getHours();
        const m = now.getMinutes();
        const s = now.getSeconds();
        const digitalEl = document.getElementById(`digital-${i}`);
        if(digitalEl){
          digitalEl.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
          digitalEl.style.display = c.analog ? 'none' : 'block';
        }

        // analog
        const hourHand = document.getElementById(`hour-${i}`);
        const minHand = document.getElementById(`min-${i}`);
        const secHand = document.getElementById(`sec-${i}`);
        if(hourHand && minHand && secHand){
          // compute angles
          const hour12 = h % 12;
          const hourAngle = (hour12 * 30) + (m * 0.5);
          const minAngle = m * 6 + (s * 0.1);
          const secAngle = s * 6;
          hourHand.style.transform = `rotate(${hourAngle}deg) translateX(-50%)`;
          minHand.style.transform = `rotate(${minAngle}deg) translateX(-50%)`;
          secHand.style.transform = `rotate(${secAngle}deg) translateX(-50%)`;
          // show/hide based on analog flag
          document.getElementById(`face-${i}`).style.display = c.analog ? 'flex' : 'none';
        }
      }catch(e){ /* ignore timezone errors */ }
    });
  }

  /* ===========================
     INIT + EVENT BINDINGS
     =========================== */
  loadState();

  // restore TIMEZONEDB key from saved state if present
  const apiKeyInput = document.getElementById('tzApiKey');
  apiKeyInput.value = TIMEZONEDB_API_KEY || '';
  document.getElementById('saveApiKeyBtn').addEventListener('click', ()=> {
    TIMEZONEDB_API_KEY = apiKeyInput.value.trim();
    // try to fetch zones
    fetchZonesFromAPI().then(()=> { alert('Si la API key es v√°lida, la lista completa estar√° disponible para b√∫squeda. Si no, se usa la lista local.'); });
    // save key locally? (we won't persist API key in this demo unless you want)
  });

  // tab switching
  const tabs = document.querySelectorAll('.tab-btn');
  tabs.forEach(b => {
    b.addEventListener('click', ()=> {
      document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const tab = b.dataset.tab;
      document.querySelectorAll('.section').forEach(s=> s.style.display = 'none');
      if(tab==='timers') document.getElementById('timersTab').style.display = 'block';
      if(tab==='stopwatch') document.getElementById('stopwatchTab').style.display = 'block';
      if(tab==='world') document.getElementById('worldTabMobile').style.display = 'block';
    });
  });

  // add timer button
  document.getElementById('addTimerBtn').addEventListener('click', ()=> {
    addTimer(`Temporizador ${state.timers.length + 1}`, 120);
  });

  // "add selected" from suggestions (already bound) ‚Äî supports pressing Enter
  searchInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter') { e.preventDefault(); addSelectedBtn.click(); }
  });

  // load zones if API key is present in var or saved state
  (async function init(){
    // if user has provided API key in saved state, use it
    if((TIMEZONEDB_API_KEY || '').length > 0) {
      await fetchZonesFromAPI();
    }
    // initial renders
    if(!state.timers || state.timers.length === 0){
      // create some sample timers if none exist
      addTimer('Descanso corto', 300);
      addTimer('Pomodoro', 1500);
    } else {
      renderTimers();
    }

    renderClocks();
    // set clocks update interval
    setInterval(updateClocks, 1000);

    // start timers ticker if any active
    if(state.timers.some(t=>t.active)) ensureTimersTicker();

    // restore stopwatch running state (do not auto-run)
    swRender(); renderLaps();

    // suggestions hide initially
    suggestionsWrap.style.display = 'none';
  })();

  // expose a small helper for user to quickly set API key via JS console:
  window._setTimezoneDBKey = function(key){
    TIMEZONEDB_API_KEY = key || '';
    document.getElementById('tzApiKey').value = TIMEZONEDB_API_KEY;
    if(TIMEZONEDB_API_KEY) fetchZonesFromAPI().then(()=> alert('Intent√© cargar zonas desde TimezoneDB (si la key y CORS son v√°lidos, ver√°s la lista completa al buscar).'));
  };
  

  </script>
  <!-- Bot√≥n de cambio de tema -->
<button id="themeToggle" title="Cambiar tema">üåô</button>

<script>
  const themeToggle = document.getElementById("themeToggle");
  const body = document.body;

  // üöÄ Al cargar, aplicamos el tema guardado en localStorage
  if (localStorage.getItem("theme") === "dark") {
    body.classList.add("dark-mode");
    themeToggle.textContent = "‚òÄÔ∏è"; // icono de sol
  }

  // üëÜ Evento para cambiar tema
  themeToggle.addEventListener("click", () => {
    body.classList.toggle("dark-mode");

    if (body.classList.contains("dark-mode")) {
      themeToggle.textContent = "‚òÄÔ∏è";
      localStorage.setItem("theme", "dark");
    } else {
      themeToggle.textContent = "üåô";
      localStorage.setItem("theme", "light");
    }
  });  
  function playSound(sound){
  if(!sound) { playBeep(); return; }
  if(sound.type === 'preset'){
    const p = PRESETS[sound.id];
    if(!p) { playBeep(); return; }
    if(p.src){ new Audio(p.src).play().catch(()=>{}); }
    else playBeep();
  } else if(sound.type === 'custom'){
    try{ new Audio(sound.data).play().catch(()=>{}); } catch(e){ console.warn(e); playBeep(); }
  }
}
let alarmInterval = null;
function startAlarmLoop(sound){
  stopAlarmLoop(); // por si ya hab√≠a uno activo
  alarmInterval = setInterval(()=> playSound(sound), 2000); // cada 2s
}

function stopAlarmLoop(){
  if(alarmInterval){
    clearInterval(alarmInterval);
    alarmInterval = null;
  }
}

// Referencias a elementos DOM para autenticaci√≥n
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const userInfo = document.getElementById('userInfo');
const userName = document.getElementById('userName');
const logoutBtn = document.getElementById('logoutBtn');
const loginModal = document.getElementById('loginModal');
const registerModal = document.getElementById('registerModal');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const loginError = document.getElementById('loginError');
const registerError = document.getElementById('registerError');
const switchToRegister = document.getElementById('switchToRegister');
const switchToLogin = document.getElementById('switchToLogin');

// Evento para abrir modal de inicio de sesi√≥n
loginBtn.addEventListener('click', function() {
  loginModal.classList.add('active');
});

// Evento para abrir modal de registro
registerBtn.addEventListener('click', function() {
  registerModal.classList.add('active');
});

// Eventos para cerrar modales al hacer clic fuera
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', function(e) {
    if (e.target === overlay) {
      overlay.classList.remove('active');
    }
  });
});

// Eventos para cerrar modales con bot√≥n X
document.querySelectorAll('.modal-close').forEach(btn => {
  btn.addEventListener('click', function() {
    this.closest('.modal-overlay').classList.remove('active');
  });
});

// Eventos para cambiar entre modales
switchToRegister.addEventListener('click', function() {
  loginModal.classList.remove('active');
  registerModal.classList.add('active');
});

switchToLogin.addEventListener('click', function() {
  registerModal.classList.remove('active');
  loginModal.classList.add('active');
});

// Funci√≥n para manejar el inicio de sesi√≥n
loginForm.addEventListener('submit', function(e) {
  e.preventDefault();
  
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const errorElement = document.getElementById('loginError');
  
  // Obtener usuarios
  const users = JSON.parse(localStorage.getItem('users')) || [];
  
  // Buscar usuario
  const user = users.find(u => u.email === email && u.password === password);
  
  if (user) {
    // Guardar sesi√≥n
    localStorage.setItem('currentUser', JSON.stringify(user));
    
    // Actualizar UI
    updateUIForLoggedInUser(user);
    
    // Cerrar modal
    loginModal.classList.remove('active');
    
    // Limpiar formulario
    loginForm.reset();
  } else {
    errorElement.textContent = 'Correo electr√≥nico o contrase√±a incorrectos';
  }
});

// Funci√≥n para manejar el registro
registerForm.addEventListener('submit', function(e) {
  e.preventDefault();
  
  const name = document.getElementById('registerName').value;
  const email = document.getElementById('registerEmail').value;
  const password = document.getElementById('registerPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const errorElement = document.getElementById('registerError');
  
  // Validar que las contrase√±as coincidan
  if (password !== confirmPassword) {
    errorElement.textContent = 'Las contrase√±as no coinciden';
    return;
  }
  
  // Obtener usuarios existentes o inicializar array
  let users = JSON.parse(localStorage.getItem('users')) || [];
  
  // Verificar si el correo ya existe
  const userExists = users.some(user => user.email === email);
  if (userExists) {
    errorElement.textContent = 'Este correo electr√≥nico ya est√° registrado';
    return;
  }
  
  // Crear nuevo usuario
  const newUser = {
    id: Date.now().toString(),
    name,
    email,
    password // En una aplicaci√≥n real, la contrase√±a deber√≠a estar encriptada
  };
  
  // Guardar usuario
  users.push(newUser);
  localStorage.setItem('users', JSON.stringify(users));
  
  // Iniciar sesi√≥n autom√°ticamente
  localStorage.setItem('currentUser', JSON.stringify(newUser));
  
  // Actualizar UI
  updateUIForLoggedInUser(newUser);
  
  // Cerrar modal
  registerModal.classList.remove('active');
  
  // Limpiar formulario
  registerForm.reset();
});

// Funci√≥n para cerrar sesi√≥n
logoutBtn.addEventListener('click', function() {
  localStorage.removeItem('currentUser');
  updateUIForLoggedInUser(null);
});

// Funci√≥n para verificar estado de autenticaci√≥n al cargar la p√°gina
function checkAuthStatus() {
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  updateUIForLoggedInUser(currentUser);
}

// Funci√≥n para actualizar la UI seg√∫n el estado de autenticaci√≥n
function updateUIForLoggedInUser(user) {
  if (user) {
    loginBtn.style.display = 'none';
    registerBtn.style.display = 'none';
    userInfo.style.display = 'flex';
    userName.textContent = user.name;
  } else {
    loginBtn.style.display = 'inline-block';
    registerBtn.style.display = 'inline-block';
    userInfo.style.display = 'none';
  }
}

// Crear un usuario predefinido para el propietario
function createDefaultUser() {
  // Verificar si ya existe el usuario predefinido
  let users = JSON.parse(localStorage.getItem('users')) || [];
  const defaultUserEmail = 'arnavor@usuario.com';
  
  // Si no existe el usuario predefinido, crearlo
  if (!users.some(user => user.email === defaultUserEmail)) {
    const defaultUser = {
      id: 'owner-' + Date.now().toString(),
      name: 'Arnavor',
      email: defaultUserEmail,
      password: 'Reloj2024#',
      isOwner: true
    };
    
    users.push(defaultUser);
    localStorage.setItem('users', JSON.stringify(users));
    console.log('Usuario predefinido creado con √©xito');
  }
}

// Llamar a la funci√≥n para crear el usuario predefinido al cargar la p√°gina
createDefaultUser();

// Verificar estado de autenticaci√≥n al cargar
checkAuthStatus();

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="es">

















